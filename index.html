<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Los Santos Dept. Nuclear & Power</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #0a0a0d; color: #d8d8dc; overflow: hidden; }
        :root { --bg:#0a0a0d; --sidebar:#0e0e11; --panel:#141418; --border:rgba(245,166,35,0.08); --border-hover:rgba(245,166,35,0.15); --text:#d8d8dc; --text-sub:rgba(255,255,255,0.4); --text-muted:rgba(255,255,255,0.2); --accent:#f5a623; --accent-dark:#e89b29; --accent-dim:rgba(245,166,35,0.1); --accent-glow:rgba(245,166,35,0.2); --warning:#ef4444; --green:#10b981; }
        
        .login-page { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; position: relative; }
        .login-page.hidden { display: none; }
        .login-glow { position: absolute; width: 400px; height: 400px; border-radius: 50%; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); top: 30%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; }
        .login-brand { text-align: center; margin-bottom: 40px; position: relative; z-index: 1; }
        .login-badge { display: inline-flex; align-items: center; gap: 10px; background: var(--accent-dim); border: 1px solid var(--accent-glow); border-radius: 10px; padding: 8px 16px; margin-bottom: 15px; }
        .login-dot { width: 18px; height: 18px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent-dark)); box-shadow: 0 0 10px var(--accent-glow); }
        .login-badge-text { font-size: 13px; color: var(--accent); font-weight: 600; letter-spacing: 0.8px; text-transform: uppercase; }
        .login-subtitle { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; }
        .login-box { background: #17171b; border: 1px solid var(--border-hover); border-radius: 12px; padding: 30px; width: 350px; position: relative; z-index: 1; }
        .login-title { font-size: 20px; font-weight: 600; margin-bottom: 5px; text-align: center; color: #fff; }
        .login-desc { font-size: 12px; color: var(--text-sub); text-align: center; margin-bottom: 25px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 11px; color: var(--text-sub); margin-bottom: 5px; font-weight: 500; }
        .form-input { width: 100%; padding: 10px 12px; border-radius: 7px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); color: #fff; font-size: 13px; outline: none; font-family: inherit; }
        .form-input:focus { border-color: var(--accent-glow); }
        .btn-login { width: 100%; padding: 11px; border-radius: 7px; background: linear-gradient(135deg, var(--accent), var(--accent-dark)); color: #fff; border: none; font-size: 14px; font-weight: 500; cursor: pointer; font-family: inherit; margin-top: 5px; box-shadow: 0 2px 12px var(--accent-glow); }
        .btn-login:hover { box-shadow: 0 4px 16px var(--accent-glow); }
        .error-msg { display: none; color: var(--warning); font-size: 12px; margin-top: 10px; text-align: center; }
        .error-msg.show { display: block; }
        
        .dashboard { display: none; width: 100vw; height: 100vh; }
        .dashboard.active { display: flex; }
        .sidebar { width: 210px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 19px 17px; border-bottom: 1px solid var(--border); }
        .sidebar-brand { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .sidebar-logo { width: 27px; height: 27px; border-radius: 7px; background: linear-gradient(135deg, var(--accent), var(--accent-dark)); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 8px var(--accent-glow); }
        .sidebar-logo-dot { width: 12px; height: 12px; border-radius: 50%; background: #fff; }
        .sidebar-text { font-size: 11.5px; font-weight: 700; color: #fff; line-height: 1.2; }
        .sidebar-subtitle { font-size: 8.5px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.6px; margin-top: 3px; margin-left: 35px; }
        .sidebar-nav { flex: 1; padding: 13px 8px; overflow-y: auto; }
        .nav-item { display: flex; align-items: center; gap: 9px; padding: 8px 10px; border-radius: 6px; cursor: pointer; margin-bottom: 1px; font-size: 12px; color: var(--text-sub); transition: all 0.15s; }
        .nav-item:hover { background: rgba(245,166,35,0.05); }
        .nav-item.active { background: var(--accent-dim); color: #fff; font-weight: 500; }
        .sidebar-user { padding: 11px 8px; border-top: 1px solid var(--border); }
        .user-info { display: flex; align-items: center; gap: 9px; padding: 7px 9px; }
        .user-avatar { width: 29px; height: 29px; border-radius: 6px; background: linear-gradient(135deg, var(--accent), var(--accent-dark)); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: #fff; }
        .user-name { font-size: 11.5px; color: #fff; font-weight: 500; }
        .user-role { font-size: 9px; color: var(--text-muted); }
        .btn-logout { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px; padding: 0; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .topbar { padding: 12px 25px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); background: var(--bg); }
        .page-title { font-size: 15.5px; color: #fff; font-weight: 600; }
        .page-subtitle { font-size: 11px; color: var(--text-sub); margin-top: 1px; }
        .content { flex: 1; overflow-y: auto; padding: 21px 25px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 13px; margin-bottom: 22px; }
        .stats-grid-3 { grid-template-columns: repeat(3, 1fr); }
        .stat-card { background: var(--panel); border: 1px solid var(--border); border-radius: 11px; padding: 17px; }
        .stat-label { font-size: 10.5px; color: var(--text-sub); margin-bottom: 5px; }
        .stat-value { font-size: 21px; font-weight: 600; }
        .stat-value.accent { color: var(--accent); }
        .stat-value.green { color: var(--green); }
        .stat-value.warning { color: var(--warning); }
        .stat-value.white { color: #fff; }
        
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 11px; overflow: hidden; margin-bottom: 20px; }
        .panel-header { padding: 13px 17px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .panel-title { font-size: 13px; color: #fff; font-weight: 500; }
        .panel-content { padding: 13px 17px; }
        
        .btn { display: inline-flex; align-items: center; gap: 6px; padding: 6px 13px; border-radius: 6px; font-size: 11.5px; cursor: pointer; font-family: inherit; border: none; transition: all 0.15s; }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-primary { background: var(--accent-dim); border: 1px solid var(--accent-glow); color: var(--accent); }
        .btn-primary:hover:not(:disabled) { background: rgba(245,166,35,0.15); }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text-sub); }
        .btn-danger { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); color: var(--warning); }
        .btn-danger:hover:not(:disabled) { background: rgba(239,68,68,0.15); }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 200; }
        .modal.show { display: flex; }
        .modal-content { background: #17171b; border: 1px solid var(--border-hover); border-radius: 12px; width: 420px; max-height: 85vh; overflow-y: auto; padding: 26px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
        .modal-title { font-size: 14.5px; color: #fff; font-weight: 600; }
        .modal-body { display: flex; flex-direction: column; gap: 12px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 16px; }
        
        .data-row { display: flex; align-items: center; padding: 11px 0; border-bottom: 1px solid var(--border); }
        .data-avatar { width: 34px; height: 34px; border-radius: 7px; background: var(--accent-dim); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: var(--accent); margin-right: 11px; flex-shrink: 0; }
        .data-info { flex: 1; min-width: 0; }
        .data-name { font-size: 12.5px; color: #fff; font-weight: 500; }
        .data-detail { font-size: 10.5px; color: var(--text-sub); }
        .badge { font-size: 10px; padding: 3px 8px; border-radius: 4px; margin-left: 10px; }
        .badge-accent { color: var(--accent); background: var(--accent-dim); }
        .badge-green { color: var(--green); background: rgba(16,185,129,0.1); }
        .badge-warning { color: var(--warning); background: rgba(239,68,68,0.1); }
        
        .empty-state { text-align: center; padding: 36px 18px; color: var(--text-muted); }
        .empty-icon { font-size: 26px; margin-bottom: 9px; opacity: 0.35; }
        
        select { width: 100%; padding: 8px 11px; border-radius: 6px; background: #17171b; border: 1px solid var(--border); color: #fff; font-size: 12px; outline: none; font-family: inherit; }
        select option { background: #17171b; color: #fff; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .warnings-grid { display: flex; gap: 6px; margin-left: 45px; margin-top: 8px; }
        .warning-box { width: 24px; height: 24px; border-radius: 5px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid var(--border); background: rgba(255,255,255,0.04); }
        .warning-box.checked { background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.4); }
        .warning-label { font-size: 10px; color: var(--text-muted); margin-left: 6px; }
        .urgent-section { background: rgba(239,68,68,0.06); border: 1px solid rgba(239,68,68,0.2); border-radius: 11px; padding: 15px 17px; margin-bottom: 18px; }
        .urgent-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .urgent-title { font-size: 12.5px; color: var(--warning); font-weight: 600; }
        .urgent-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 7px; }
        .urgent-card { background: rgba(239,68,68,0.05); border: 1px solid rgba(239,68,68,0.15); border-radius: 7px; padding: 9px 11px; display: flex; gap: 9px; }
        .grid-companies { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; }
        .company-card { display: flex; justify-content: space-between; padding: 8px 11px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 7px; }
        .hidden { display: none !important; }
        .btn-delete { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); color: var(--warning); padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; font-family: inherit; transition: all 0.15s; }
        .btn-delete:hover { background: rgba(239,68,68,0.15); }
    </style>
</head>
<body>
    <div id="loginPage" class="login-page">
        <div class="login-glow"></div>
        <div class="login-brand">
            <div class="login-badge">
                <div class="login-dot"></div>
                <div class="login-badge-text">Los Santos Dept. Nuclear Power</div>
            </div>
            <div class="login-subtitle">Filiale Production</div>
        </div>
        <div class="login-box">
            <div class="login-title">Connexion Direction</div>
            <div class="login-desc">Acc√®s r√©serv√© √† la direction</div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Identifiant</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Nom d'utilisateur" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label">Mot de passe</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off">
                </div>
                <button type="submit" class="btn-login">Se Connecter</button>
                <div id="loginError" class="error-msg">Identifiants incorrects</div>
            </form>
        </div>
    </div>

    <div id="dashboard" class="dashboard">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <div class="sidebar-logo"><div class="sidebar-logo-dot"></div></div>
                    <div>
                        <div class="sidebar-text">Los Santos Dept.</div>
                        <div class="sidebar-text">Nuclear & Power</div>
                    </div>
                </div>
                <div class="sidebar-subtitle">Filiale Production</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-item active" onclick="showPage('dashboard')"><span style="margin-right:5px;">üìä</span>Tableau de Bord</div>
                <div class="nav-item" onclick="showPage('team')"><span style="margin-right:5px;">üë•</span>√âquipe</div>
                <div class="nav-item" onclick="showPage('contacts')"><span style="margin-right:5px;">‚úâÔ∏è</span>Contacts</div>
                <div class="nav-item" onclick="showPage('commercial')"><span style="margin-right:5px;">üíº</span>Commercial</div>
                <div class="nav-item" onclick="showPage('accounting')"><span style="margin-right:5px;">üíµ</span>Comptabilit√©</div>
                <div id="navAdmin" class="nav-item hidden" onclick="showPage('admin')"><span style="margin-right:5px;">üõ°Ô∏è</span>Administration</div>
            </div>
            <div class="sidebar-user">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">AD</div>
                    <div style="flex:1;">
                        <div class="user-name" id="userName">admin</div>
                        <div class="user-role" id="userRole">CEO</div>
                    </div>
                    <button class="btn-logout" onclick="logout()">üö™</button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="topbar">
                <div>
                    <div class="page-title" id="pageTitle">Tableau de Bord</div>
                    <div class="page-subtitle">Aper√ßu g√©n√©ral ‚Äî Los Santos Dept. of Nuclear Power</div>
                </div>
            </div>
            <div class="content" id="content"></div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="btn-logout" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        const GRADES = {
            directeur: { label: 'Chief Executive Officer', salary: 20000, canAdmin: true, canViewDash: true, canManageAll: true },
            codir: { label: 'Chief Operating Officer', salary: 20000, canManageAll: true },
            drh: { label: 'Directives Humans Resources', salary: 18000, canManageAll: true },
            rh: { label: 'Humans Resources', salary: 16000, canManage: true },
            manager: { label: 'Manager', salary: 16000, canManage: true },
            producteur: { label: 'Nuclear Production Engineer', salary: 11000 }
        };

        const SALARY_TIERS = [
            { minDays: 0, maxDays: 6, base: 11000 },
            { minDays: 7, maxDays: 13, base: 13000 },
            { minDays: 14, maxDays: Infinity, base: 15000 }
        ];

        const EXPENSE_CATS = [
            { key: 'matieres', label: 'Mati√®res Premi√®res', icon: '‚¨°', color: '#f5a623' },
            { key: 'bienbeing', label: 'Bien-√ätre', icon: '‚óé', color: '#e89b29' },
            { key: 'professionnel', label: 'Frais Professionnels', icon: '‚óÜ', color: '#fbbf24' },
            { key: 'evenement', label: '√âv√®nementielles', icon: '‚óá', color: '#f59e0b' },
            { key: 'divers', label: 'Divers', icon: '‚óã', color: '#d97706' }
        ];

        let currentUser = null;
        let sessionTimeout = null;
        const SESSION_DURATION = 10 * 60 * 1000;
        
        let users = JSON.parse(localStorage.getItem('users') || '[{"id":1,"username":"admin","password":"admin123","grade":"directeur"}]');
        let employees = JSON.parse(localStorage.getItem('employees') || '[]');
        let contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
        let pins = JSON.parse(localStorage.getItem('pins') || '[]');
        let partners = JSON.parse(localStorage.getItem('partners') || '[]');
        let resources = JSON.parse(localStorage.getItem('resources') || '[]');
        let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        let subcategories = JSON.parse(localStorage.getItem('subcategories') || '[]');
        let companies = JSON.parse(localStorage.getItem('companies') || '[]');

        function save(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
        function daysSince(dateStr) { const hired = new Date(dateStr); return Math.floor((Date.now() - hired) / 86400000); }
        function getSalary(grade, hireDate) {
            if (grade !== 'producteur') return GRADES[grade]?.salary || 0;
            const days = daysSince(hireDate);
            const tier = SALARY_TIERS.find(t => days >= t.minDays && days <= t.maxDays);
            return tier ? tier.base : 15000;
        }
        function getTotalExpenses() {
            const expenseTotal = expenses.reduce((s,e) => s+e.amount, 0);
            const salaryTotal = employees.reduce((s,e) => s+getSalary(e.grade,e.hireDate), 0);
            return expenseTotal + salaryTotal;
        }

        function startSessionTimer() {
            if (sessionTimeout) clearTimeout(sessionTimeout);
            sessionTimeout = setTimeout(() => {
                alert('Session expir√©e (10 min). Reconnectez-vous.');
                logout();
            }, SESSION_DURATION);
        }
        function resetSessionTimer() { if (currentUser) startSessionTimer(); }
        document.addEventListener('click', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                startSessionTimer();
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('userName').textContent = user.username;
                document.getElementById('userAvatar').textContent = user.username.substring(0,2).toUpperCase();
                document.getElementById('userRole').textContent = GRADES[user.grade].label;
                if (user.grade === 'directeur') document.getElementById('navAdmin').classList.remove('hidden');
                showPage('dashboard');
            } else {
                document.getElementById('loginError').classList.add('show');
                setTimeout(() => document.getElementById('loginError').classList.remove('show'), 3000);
            }
        });

        function logout() {
            if (sessionTimeout) clearTimeout(sessionTimeout);
            currentUser = null;
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showModal(title, bodyHTML) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = bodyHTML;
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() { document.getElementById('modal').classList.remove('show'); }
        
        // Close modal on outside click
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target.id === 'modal') closeModal();
        });

        function showPage(page) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(event && event.target) {
                const nav = event.target.closest('.nav-item');
                if(nav) nav.classList.add('active');
            }
            
            const titles = { dashboard: 'Tableau de Bord', team: '√âquipe', contacts: 'Contacts', commercial: 'Commercial', accounting: 'Comptabilit√©', admin: 'Administration' };
            document.getElementById('pageTitle').textContent = titles[page];

            const content = document.getElementById('content');
            if (page === 'dashboard') renderDashboard(content);
            else if (page === 'team') renderTeam(content);
            else if (page === 'contacts') renderContacts(content);
            else if (page === 'commercial') renderCommercial(content);
            else if (page === 'accounting') renderAccounting(content);
            else if (page === 'admin') renderAdmin(content);
        }

        // DELETE FUNCTIONS - Using window functions to make them globally accessible
        window.deleteEmployee = function(id) {
            if (confirm('Supprimer cet employ√© ?')) {
                employees = employees.filter(e => e.id !== id);
                save('employees', employees);
                showPage('team');
            }
        };

        window.deletePin = function(id) {
            if (confirm('Supprimer ce contact √©pingl√© ?')) {
                pins = pins.filter(p => p.id !== id);
                save('pins', pins);
                showPage('contacts');
            }
        };

        window.deleteContact = function(id) {
            if (confirm('Supprimer ce contact ?')) {
                contacts = contacts.filter(c => c.id !== id);
                save('contacts', contacts);
                showPage('contacts');
            }
        };

        window.deletePartner = function(id) {
            if (confirm('Supprimer ce partenaire ?')) {
                partners = partners.filter(p => p.id !== id);
                save('partners', partners);
                showPage('commercial');
            }
        };

        window.deleteResource = function(id) {
            if (confirm('Supprimer cette ressource ?')) {
                resources = resources.filter(r => r.id !== id);
                save('resources', resources);
                showPage('commercial');
            }
        };

        window.deleteExpense = function(id) {
            if (confirm('Supprimer cette d√©pense ?')) {
                expenses = expenses.filter(e => e.id !== id);
                save('expenses', expenses);
                showPage('accounting');
            }
        };

        window.deleteSubcat = function(id) {
            if (confirm('Supprimer cette sous-cat√©gorie ?')) {
                subcategories = subcategories.filter(s => s.id !== id);
                save('subcategories', subcategories);
                showPage('accounting');
            }
        };

        window.deleteCompany = function(id) {
            if (confirm('Supprimer cette entreprise ?')) {
                companies = companies.filter(c => c.id !== id);
                save('companies', companies);
                showPage('admin');
            }
        };

        window.deleteUser = function(id) {
            if (confirm('Supprimer cet utilisateur ?')) {
                users = users.filter(u => u.id !== id);
                save('users', users);
                showPage('admin');
            }
        };

        window.toggleWarning = function(empId, idx) {
            const emp = employees.find(e => e.id === empId);
            if (emp) {
                emp.warnings[idx] = !emp.warnings[idx];
                save('employees', employees);
                showPage('team');
            }
        };

        function renderDashboard(el) {
            const totalExp = getTotalExpenses();
            el.innerHTML = '<div class="stats-grid"><div class="stat-card"><div class="stat-label">Chiffre d\'Affaires</div><div class="stat-value accent">$ 0</div></div><div class="stat-card"><div class="stat-label">B√©n√©fice Net</div><div class="stat-value green">$ 0</div></div><div class="stat-card"><div class="stat-label">D√©penses Totales</div><div class="stat-value warning">$ '+totalExp.toLocaleString()+'</div></div><div class="stat-card"><div class="stat-label">Employ√©s</div><div class="stat-value white">'+employees.length+'</div></div></div><div class="panel"><div class="panel-header"><div class="panel-title">Activit√© R√©cente</div></div><div class="panel-content"><div class="empty-state"><div class="empty-icon">üìã</div><div>Aucune activit√©</div></div></div></div>';
        }

        function renderTeam(el) {
            const canManage = GRADES[currentUser.grade]?.canManageAll;
            const totalSalary = employees.reduce((s,e)=>s+getSalary(e.grade,e.hireDate),0);
            let html = '<div class="stats-grid stats-grid-3"><div class="stat-card"><div class="stat-label">Employ√©s Actifs</div><div class="stat-value accent">'+employees.length+'</div></div><div class="stat-card"><div class="stat-label">En Cong√©</div><div class="stat-value warning">0</div></div><div class="stat-card"><div class="stat-label">Masse Salariale</div><div class="stat-value green">$ '+totalSalary.toLocaleString()+'</div></div></div><div class="panel"><div class="panel-header"><div class="panel-title">Liste des Employ√©s</div>';
            if(canManage) html += '<button class="btn btn-primary" onclick="openAddEmployee()"><span style="font-size:13px;">+</span> Ajouter</button>';
            html += '</div><div class="panel-content">';
            
            if(employees.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">üë•</div><div>Aucun employ√©</div></div>';
            } else {
                employees.forEach(e => {
                    const days = daysSince(e.hireDate);
                    const salary = getSalary(e.grade, e.hireDate);
                    html += '<div class="data-row"><div class="data-avatar">'+e.firstName[0]+e.lastName[0]+'</div><div class="data-info"><div class="data-name">'+e.firstName+' '+e.lastName+'</div><div class="data-detail">'+GRADES[e.grade].label+' ¬∑ '+e.phone+' ¬∑ Anc: '+days+'j</div></div><div style="font-size:13px;font-weight:600;color:var(--accent);margin-right:14px;">$ '+salary.toLocaleString()+'/mois</div>';
                    if(canManage) html += '<button class="btn-delete" onclick="deleteEmployee('+e.id+')">üóëÔ∏è</button>';
                    html += '</div><div class="warnings-grid">';
                    e.warnings.forEach((w,i) => {
                        html += '<div class="warning-box '+(w?'checked':'')+'"'+(canManage?' onclick="toggleWarning('+e.id+','+i+')"':'')+'>'+(w?'‚ö†Ô∏è':'')+'</div>';
                    });
                    html += '<span class="warning-label">Avertissements</span></div>';
                });
            }
            html += '</div></div>';
            el.innerHTML = html;
        }

        function renderContacts(el) {
            const canManage = GRADES[currentUser.grade]?.canManageAll;
            let html = '<div class="urgent-section"><div class="urgent-header"><div class="urgent-title">üìå URGENCE ‚Äî Contacts √âpingl√©s <span style="font-size:9.5px;background:rgba(239,68,68,0.12);padding:2px 6px;border-radius:9px;margin-left:5px;">'+pins.length+'/7</span></div>';
            if(pins.length < 7) html += '<button class="btn btn-danger" onclick="openAddPin()" style="padding:4px 9px;font-size:10.5px;"><span style="font-size:10px;">+</span> √âpingler</button>';
            html += '</div>';
            
            if(pins.length === 0) {
                html += '<div style="text-align:center;padding:16px 0;color:var(--text-muted);font-size:11px;">Aucun contact d\'urgence</div>';
            } else {
                html += '<div class="urgent-grid">';
                pins.forEach(p => {
                    html += '<div class="urgent-card"><div style="width:26px;height:26px;border-radius:6px;background:rgba(239,68,68,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0;">üìû</div><div style="flex:1;min-width:0;"><div style="font-size:11.5px;color:#fff;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+p.name+'</div><div style="font-size:10px;color:var(--warning);">'+p.phone+'</div></div><button class="btn-logout" onclick="deletePin('+p.id+')" style="font-size:12px;">‚úï</button></div>';
                });
                html += '</div>';
            }
            html += '</div>';
            
            html += '<div class="panel"><div class="panel-header"><div class="panel-title">Annuaire de Contacts</div>';
            if(canManage) html += '<button class="btn btn-primary" onclick="openAddContact()"><span style="font-size:13px;">+</span> Ajouter</button>';
            html += '</div><div class="panel-content">';
            
            if(contacts.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">üìá</div><div>Aucun contact</div></div>';
            } else {
                contacts.forEach(c => {
                    const initials = c.name.split(' ').map(n=>n[0]).join('').slice(0,2);
                    html += '<div class="data-row"><div class="data-avatar">'+initials+'</div><div class="data-info"><div class="data-name">'+c.name+'</div><div class="data-detail">'+(c.company||'‚Äî')+' ¬∑ '+c.phone+'</div></div><span class="badge badge-accent">'+c.type+'</span>';
                    if(canManage) html += '<button class="btn-delete" onclick="deleteContact('+c.id+')">üóëÔ∏è</button>';
                    html += '</div>';
                });
            }
            html += '</div></div>';
            el.innerHTML = html;
        }

        function renderCommercial(el) {
            const canManage = GRADES[currentUser.grade]?.canManageAll;
            let html = '<div class="stats-grid stats-grid-3"><div class="stat-card"><div class="stat-label">Pipeline Total</div><div class="stat-value accent">$ 0</div></div><div class="stat-card"><div class="stat-label">Partenaires</div><div class="stat-value green">'+partners.length+'</div></div><div class="stat-card"><div class="stat-label">Ressources</div><div class="stat-value white">'+resources.length+'</div></div></div><div style="display:grid;grid-template-columns:1.2fr 1fr;gap:16px;"><div class="panel"><div class="panel-header"><div class="panel-title">Partenaires Commerciaux</div>';
            if(canManage) html += '<button class="btn btn-primary" onclick="openAddPartner()"><span style="font-size:13px;">+</span> Ajouter</button>';
            html += '</div><div class="panel-content">';
            
            if(partners.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">ü§ù</div><div>Aucun partenaire</div></div>';
            } else {
                partners.forEach(p => {
                    html += '<div style="padding:11px 0;border-bottom:1px solid var(--border);"><div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span style="font-size:12.5px;color:#fff;font-weight:500;">'+p.name+'</span></div><div style="font-size:10.5px;color:var(--text-sub);">'+(p.contact||'')+' '+(p.phone?'¬∑ '+p.phone:'')+' '+(p.company?'¬∑ '+p.company:'')+'</div>';
                    if(canManage) html += '<div style="display:flex;justify-content:flex-end;margin-top:5px;"><button class="btn-delete" onclick="deletePartner('+p.id+')" style="padding:2px 6px;font-size:10px;">üóëÔ∏è Supprimer</button></div>';
                    html += '</div>';
                });
            }
            
            html += '</div></div><div class="panel"><div class="panel-header"><div class="panel-title">Ressources / Articles</div>';
            if(canManage) html += '<button class="btn btn-primary" onclick="openAddResource()"><span style="font-size:13px;">+</span> Ajouter</button>';
            html += '</div><div class="panel-content">';
            
            if(resources.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">üì¶</div><div>Aucune ressource</div></div>';
            } else {
                resources.forEach(r => {
                    html += '<div class="data-row"><div class="data-avatar">üì¶</div><div class="data-info"><div class="data-name">'+r.name+'</div><div class="data-detail">'+(r.company||'')+' '+(r.quantity?'¬∑ Qt√©: '+r.quantity+' '+(r.unit||''):'')+'</div></div><div style="font-size:12.5px;font-weight:600;color:var(--accent);margin-right:11px;">$ '+(r.price||0).toLocaleString()+'</div>';
                    if(canManage) html += '<button class="btn-delete" onclick="deleteResource('+r.id+')">üóëÔ∏è</button>';
                    html += '</div>';
                });
            }
            html += '</div></div></div>';
            el.innerHTML = html;
        }

        function renderAccounting(el) {
            const canManage = GRADES[currentUser.grade]?.canManageAll || currentUser.grade === 'manager' || currentUser.grade === 'rh';
            const expenseTotal = expenses.reduce((s,e) => s+e.amount, 0);
            const salaryTotal = employees.reduce((s,e) => s+getSalary(e.grade,e.hireDate), 0);
            const total = expenseTotal + salaryTotal;
            
            let html = '<div class="stats-grid stats-grid-3"><div class="stat-card"><div class="stat-label">Total D√©penses</div><div class="stat-value warning">$ '+total.toLocaleString()+'</div></div><div class="stat-card"><div class="stat-label">Salaires</div><div class="stat-value accent">$ '+salaryTotal.toLocaleString()+'</div></div><div class="stat-card"><div class="stat-label">Autres D√©penses</div><div class="stat-value white">$ '+expenseTotal.toLocaleString()+'</div></div></div>';
            
            if(currentUser.grade === 'directeur' && subcategories.length > 0) {
                html += '<div class="panel"><div class="panel-header"><div class="panel-title">Sous-Cat√©gories</div></div><div class="panel-content"><div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;">';
                subcategories.forEach(s => {
                    const cat = EXPENSE_CATS.find(c => c.key === s.category);
                    html += '<div style="display:flex;justify-content:space-between;padding:7px 10px;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:7px;"><div style="display:flex;gap:7px;align-items:center;"><span style="font-size:11px;color:'+(cat?.color||'var(--accent)')+';">'+(cat?.icon||'‚óã')+'</span><span style="font-size:11.5px;color:#fff;">'+s.name+'</span></div><button onclick="deleteSubcat('+s.id+')" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:11px;">üóëÔ∏è</button></div>';
                });
                html += '</div></div></div>';
            }
            
            html += '<div class="panel"><div class="panel-header"><div class="panel-title">Journal des D√©penses</div><div style="display:flex;gap:8px;">';
            if(currentUser.grade === 'directeur') html += '<button class="btn btn-primary" onclick="openAddSubcat()"><span style="font-size:13px;">+</span> Sous-cat√©gorie</button>';
            if(canManage) html += '<button class="btn btn-primary" onclick="openAddExpense()"><span style="font-size:13px;">+</span> D√©clarer</button>';
            html += '</div></div><div class="panel-content">';
            
            if(expenses.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">üí∞</div><div>Aucune d√©pense</div></div>';
            } else {
                expenses.forEach(e => {
                    const cat = EXPENSE_CATS.find(c => c.key === e.category);
                    html += '<div class="data-row"><div class="data-avatar" style="background:'+(cat?.color+'18'||'var(--accent-dim)')+';color:'+(cat?.color||'var(--accent)')+';">'+(cat?.icon||'‚óã')+'</div><div class="data-info"><div class="data-name">'+e.description+'</div><div class="data-detail">'+(cat?.label||'‚Äî')+' '+(e.subcategory?'¬∑ '+e.subcategory:'')+' ¬∑ '+e.date+'</div></div><div style="font-size:12.5px;font-weight:600;color:var(--warning);margin-right:11px;">-$ '+e.amount.toLocaleString()+'</div>';
                    if(canManage) html += '<button class="btn-delete" onclick="deleteExpense('+e.id+')">üóëÔ∏è</button>';
                    html += '</div>';
                });
            }
            html += '</div></div>';
            el.innerHTML = html;
        }

        function renderAdmin(el) {
            let html = '<div class="panel"><div class="panel-header"><div class="panel-title">Gestion des Entreprises</div><button class="btn btn-primary" onclick="openAddCompany()"><span style="font-size:13px;">+</span> Ajouter</button></div><div class="panel-content">';
            
            if(companies.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">üè¢</div><div>Aucune entreprise</div></div>';
            } else {
                html += '<div class="grid-companies">';
                companies.forEach(c => {
                    html += '<div class="company-card"><div style="display:flex;align-items:center;gap:8px;flex:1;"><span style="font-size:13px;color:var(--accent);">üè¢</span><span style="font-size:12px;color:#fff;">'+c.name+'</span></div><button onclick="deleteCompany('+c.id+')" style="background:none;border:none;color:var(--text-muted);cursor:pointer;">üóëÔ∏è</button></div>';
                });
                html += '</div>';
            }
            
            html += '</div></div><div class="panel"><div class="panel-header"><div class="panel-title">Gestion des Utilisateurs</div><button class="btn btn-primary" onclick="openAddUser()"><span style="font-size:13px;">+</span> Ajouter</button></div><div class="panel-content">';
            
            if(users.length === 0) {
                html += '<div class="empty-state"><div class="empty-icon">üë§</div><div>Aucun utilisateur</div></div>';
            } else {
                users.forEach(u => {
                    html += '<div class="data-row"><div class="data-avatar">üõ°Ô∏è</div><div class="data-info"><div class="data-name">'+u.username+'</div><div class="data-detail">'+GRADES[u.grade].label+' ¬∑ '+'‚Ä¢'.repeat(u.password.length)+'</div></div>';
                    if(u.id !== 1) html += '<button class="btn-delete" onclick="deleteUser('+u.id+')">üóëÔ∏è</button>';
                    html += '</div>';
                });
            }
            html += '</div></div>';
            el.innerHTML = html;
        }

        function openAddEmployee() {
            showModal('Ajouter un Employ√©', '<div class="form-group"><label class="form-label">Pr√©nom</label><input type="text" class="form-input" id="empFirstName"></div><div class="form-group"><label class="form-label">Nom</label><input type="text" class="form-input" id="empLastName"></div><div class="form-group"><label class="form-label">T√©l√©phone</label><input type="text" class="form-input" id="empPhone" placeholder="xxx-xxxx"></div><div class="form-group"><label class="form-label">Grade</label><select id="empGrade">'+Object.keys(GRADES).filter(k=>k!=='directeur').map(k=>'<option value="'+k+'">'+GRADES[k].label+'</option>').join('')+'</select></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addEmployee()">Ajouter</button></div>');
        }

        function addEmployee() {
            const firstName = document.getElementById('empFirstName').value;
            const lastName = document.getElementById('empLastName').value;
            const phone = document.getElementById('empPhone').value;
            const grade = document.getElementById('empGrade').value;
            if (!firstName || !lastName || !phone) return alert('Remplissez tous les champs');
            employees.push({ id: Date.now(), firstName, lastName, phone, grade, hireDate: new Date().toISOString().split('T')[0], warnings: [false, false, false] });
            save('employees', employees);
            closeModal();
            showPage('team');
        }

        function openAddPin() {
            showModal('√âpingler un Contact', '<div class="form-group"><label class="form-label">Nom</label><input type="text" class="form-input" id="pinName"></div><div class="form-group"><label class="form-label">T√©l√©phone</label><input type="text" class="form-input" id="pinPhone"></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-danger" onclick="addPin()">√âpingler</button></div>');
        }

        function addPin() {
            const name = document.getElementById('pinName').value;
            const phone = document.getElementById('pinPhone').value;
            if (!name || !phone) return alert('Remplissez tous les champs');
            if (pins.length >= 7) return alert('Maximum 7 contacts √©pingl√©s');
            pins.push({ id: Date.now(), name, phone });
            save('pins', pins);
            closeModal();
            showPage('contacts');
        }

        function openAddContact() {
            showModal('Ajouter un Contact', '<div class="form-group"><label class="form-label">Nom</label><input type="text" class="form-input" id="contactName"></div><div class="form-group"><label class="form-label">Entreprise</label>'+(companies.length > 0 ? '<select id="contactCompany"><option value="">‚Äî Aucune ‚Äî</option>'+companies.map(c=>'<option value="'+c.name+'">'+c.name+'</option>').join('')+'</select>' : '<input type="text" class="form-input" placeholder="Aucune entreprise" disabled>')+'</div><div class="form-group"><label class="form-label">T√©l√©phone</label><input type="text" class="form-input" id="contactPhone"></div><div class="form-group"><label class="form-label">Type</label><select id="contactType"><option>Client</option><option>Fournisseur</option><option>Partenaire</option></select></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addContact()">Ajouter</button></div>');
        }

        function addContact() {
            const name = document.getElementById('contactName').value;
            const company = document.getElementById('contactCompany')?.value || '';
            const phone = document.getElementById('contactPhone').value;
            const type = document.getElementById('contactType').value;
            if (!name || !phone) return alert('Remplissez tous les champs');
            contacts.push({ id: Date.now(), name, company, phone, type });
            save('contacts', contacts);
            closeModal();
            showPage('contacts');
        }

        function openAddPartner() {
            showModal('Ajouter un Partenaire', '<div class="form-group"><label class="form-label">Nom du partenaire</label><input type="text" class="form-input" id="partnerName"></div><div class="form-group"><label class="form-label">Contact</label><input type="text" class="form-input" id="partnerContact"></div><div class="grid-2"><div class="form-group"><label class="form-label">T√©l√©phone</label><input type="text" class="form-input" id="partnerPhone"></div><div class="form-group"><label class="form-label">Entreprise</label>'+(companies.length > 0 ? '<select id="partnerCompany"><option value="">‚Äî Aucune ‚Äî</option>'+companies.map(c=>'<option value="'+c.name+'">'+c.name+'</option>').join('')+'</select>' : '<input type="text" class="form-input" placeholder="Aucune" disabled>')+'</div></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addPartner()">Enregistrer</button></div>');
        }

        function addPartner() {
            const name = document.getElementById('partnerName').value;
            if (!name) return alert('Nom requis');
            partners.push({ id: Date.now(), name, contact: document.getElementById('partnerContact').value, phone: document.getElementById('partnerPhone').value, company: document.getElementById('partnerCompany')?.value || '' });
            save('partners', partners);
            closeModal();
            showPage('commercial');
        }

        function openAddResource() {
            showModal('Ajouter une Ressource', '<div class="form-group"><label class="form-label">Nom de l\'article</label><input type="text" class="form-input" id="resName"></div><div class="form-group"><label class="form-label">Entreprise partenaire</label>'+(companies.length > 0 ? '<select id="resCompany"><option value="">‚Äî Aucune ‚Äî</option>'+companies.map(c=>'<option value="'+c.name+'">'+c.name+'</option>').join('')+'</select>' : '<div style="font-size:11px;color:var(--text-muted);padding:8px;">Aucune entreprise</div>')+'</div><div class="grid-3"><div class="form-group"><label class="form-label">Quantit√©</label><input type="number" class="form-input" id="resQty" placeholder="1"></div><div class="form-group"><label class="form-label">Unit√©</label><input type="text" class="form-input" id="resUnit" placeholder="m"></div><div class="form-group"><label class="form-label">Prix ($)</label><input type="number" class="form-input" id="resPrice" placeholder="0"></div></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addResource()">Ajouter</button></div>');
        }

        function addResource() {
            const name = document.getElementById('resName').value;
            if (!name) return alert('Nom requis');
            resources.push({ id: Date.now(), name, company: document.getElementById('resCompany')?.value || '', quantity: document.getElementById('resQty').value, unit: document.getElementById('resUnit').value, price: parseFloat(document.getElementById('resPrice').value) || 0 });
            save('resources', resources);
            closeModal();
            showPage('commercial');
        }

        function openAddExpense() {
            showModal('D√©clarer une D√©pense', '<div class="form-group"><label class="form-label">Cat√©gorie</label><select id="expCat" onchange="updateSubcats()">'+EXPENSE_CATS.map(c => '<option value="'+c.key+'">'+c.icon+' '+c.label+'</option>').join('')+'</select></div><div id="subcatGroup" class="form-group hidden"><label class="form-label">Sous-cat√©gorie</label><select id="expSubcat"></select></div><div class="form-group"><label class="form-label">Description</label><input type="text" class="form-input" id="expDesc"></div><div class="grid-2"><div class="form-group"><label class="form-label">Montant ($)</label><input type="number" class="form-input" id="expAmount"></div><div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="expDate" value="'+new Date().toISOString().split('T')[0]+'"></div></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addExpense()">Enregistrer</button></div>');
            updateSubcats();
        }

        function updateSubcats() {
            const cat = document.getElementById('expCat').value;
            const subs = subcategories.filter(s => s.category === cat);
            const group = document.getElementById('subcatGroup');
            const select = document.getElementById('expSubcat');
            if (subs.length > 0) {
                group.classList.remove('hidden');
                select.innerHTML = '<option value="">‚Äî Aucune ‚Äî</option>' + subs.map(s => '<option value="'+s.name+'">'+s.name+'</option>').join('');
            } else {
                group.classList.add('hidden');
            }
        }

        function addExpense() {
            const description = document.getElementById('expDesc').value;
            const amount = parseFloat(document.getElementById('expAmount').value);
            if (!description || !amount) return alert('Remplissez tous les champs');
            expenses.push({ id: Date.now(), category: document.getElementById('expCat').value, subcategory: document.getElementById('expSubcat')?.value || '', description, amount, date: document.getElementById('expDate').value });
            save('expenses', expenses);
            closeModal();
            showPage('accounting');
        }

        function openAddSubcat() {
            showModal('Ajouter une Sous-Cat√©gorie', '<div class="form-group"><label class="form-label">Cat√©gorie Parente</label><select id="subcatCat">'+EXPENSE_CATS.map(c => '<option value="'+c.key+'">'+c.label+'</option>').join('')+'</select></div><div class="form-group"><label class="form-label">Nom de la sous-cat√©gorie</label><input type="text" class="form-input" id="subcatName"></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addSubcat()">Ajouter</button></div>');
        }

        function addSubcat() {
            const name = document.getElementById('subcatName').value;
            if (!name) return alert('Nom requis');
            subcategories.push({ id: Date.now(), category: document.getElementById('subcatCat').value, name });
            save('subcategories', subcategories);
            closeModal();
            showPage('accounting');
        }

        function openAddCompany() {
            showModal('Ajouter une Entreprise', '<div class="form-group"><label class="form-label">Nom de l\'entreprise</label><input type="text" class="form-input" id="companyName"></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addCompany()">Ajouter</button></div>');
        }

        function addCompany() {
            const name = document.getElementById('companyName').value;
            if (!name) return alert('Nom requis');
            companies.push({ id: Date.now(), name });
            save('companies', companies);
            closeModal();
            showPage('admin');
        }

        function openAddUser() {
            showModal('Ajouter un Utilisateur', '<div class="form-group"><label class="form-label">Nom d\'utilisateur</label><input type="text" class="form-input" id="userName"></div><div class="form-group"><label class="form-label">Mot de passe</label><input type="password" class="form-input" id="userPass"></div><div class="form-group"><label class="form-label">Grade</label><select id="userGrade">'+Object.keys(GRADES).filter(k=>k!=='directeur').map(k=>'<option value="'+k+'">'+GRADES[k].label+'</option>').join('')+'</select></div><div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal()">Annuler</button><button class="btn btn-primary" onclick="addUser()">Cr√©er</button></div>');
        }

        function addUser() {
            const username = document.getElementById('userName').value;
            const password = document.getElementById('userPass').value;
            if (!username || !password) return alert('Remplissez tous les champs');
            users.push({ id: Date.now(), username, password, grade: document.getElementById('userGrade').value });
            save('users', users);
            closeModal();
            showPage('admin');
        }

        console.log('‚úÖ Los Santos Nuclear & Power');
        console.log('üë§ admin / admin123');
        console.log('‚è±Ô∏è  Session: 10 min');
    </script>
</body>
</html>
